<UserControl x:Class="inventory.Elements.EquipmentPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="800"
             Title="Оборудование">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Панель инструментов -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="10">
            <Button Content="Добавить" Command="{Binding AddCommand}">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Background" Value="#FF3A86FF"/>
                        <Setter Property="Foreground" Value="White"/>
                        <Setter Property="BorderThickness" Value="0"/>
                        <Setter Property="Padding" Value="12 6"/>
                        <Setter Property="FontSize" Value="14"/>
                        <Setter Property="FontWeight" Value="SemiBold"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="Button">
                                    <Border x:Name="border"
                                            Background="{TemplateBinding Background}"
                                            CornerRadius="8"
                                            SnapsToDevicePixels="True">
                                        <ContentPresenter x:Name="contentPresenter"
                                                        HorizontalAlignment="Center"
                                                        VerticalAlignment="Center"
                                                        Margin="{TemplateBinding Padding}"/>
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="#FF2A75E6"/>
                                        </Trigger>
                                        <Trigger Property="IsPressed" Value="True">
                                            <Setter Property="Background" Value="#FF1A65D6"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </Button.Style>
            </Button>

            <ComboBox ItemsSource="{Binding FilterOptions}"
                      SelectedItem="{Binding SelectedFilter}"
                      DisplayMemberPath="Name"
                      Width="200" Margin="10,0,0,0">
                <ComboBox.Style>
                    <Style TargetType="ComboBox">
                        <Setter Property="Height" Value="36"/>
                        <Setter Property="FontSize" Value="14"/>
                        <Setter Property="Foreground" Value="#FF212529"/>
                        <Setter Property="Background" Value="#FFF8F9FA"/>
                        <Setter Property="BorderBrush" Value="#20000000"/>
                        <Setter Property="BorderThickness" Value="1"/>
                        <Setter Property="Padding" Value="8,0"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="ComboBox">
                                    <Border CornerRadius="8"
                                            Background="{TemplateBinding Background}"
                                            BorderBrush="{TemplateBinding BorderBrush}"
                                            BorderThickness="{TemplateBinding BorderThickness}">
                                        <ScrollViewer x:Name="PART_ContentHost" Padding="{TemplateBinding Padding}"/>
                                    </Border>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </ComboBox.Style>
            </ComboBox>

            <TextBox Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                     Width="200" Margin="10,0,0,0" Padding="5">
                <TextBox.Style>
                    <Style TargetType="TextBox">
                        <Setter Property="Height" Value="36"/>
                        <Setter Property="FontSize" Value="14"/>
                        <Setter Property="Foreground" Value="#FF212529"/>
                        <Setter Property="Background" Value="#FFF8F9FA"/>
                        <Setter Property="BorderBrush" Value="#20000000"/>
                        <Setter Property="BorderThickness" Value="1"/>
                        <Setter Property="Padding" Value="12,0"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="TextBox">
                                    <Border CornerRadius="8"
                                            Background="{TemplateBinding Background}"
                                            BorderBrush="{TemplateBinding BorderBrush}"
                                            BorderThickness="{TemplateBinding BorderThickness}">
                                        <ScrollViewer x:Name="PART_ContentHost" Padding="{TemplateBinding Padding}"/>
                                    </Border>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </TextBox.Style>
            </TextBox>
        </StackPanel>

        <!-- Список оборудования -->
        <ItemsControl Grid.Row="1" ItemsSource="{Binding FilteredEquipment}" Margin="10">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <WrapPanel Orientation="Horizontal"/>
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <Border BorderThickness="1"
                            CornerRadius="6"
                            Margin="6"
                            BorderBrush="#DDDDDD"
                            Background="White"
                            Padding="0">
                        <Grid Margin="10">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Image -->
                            <Border Grid.Row="0" Grid.Column="0" Grid.RowSpan="4"
                                    Width="60" Height="60" CornerRadius="4"
                                    Background="#F8F8F8" BorderBrush="#EEEEEE" BorderThickness="1"
                                    Margin="0,0,12,0" VerticalAlignment="Top">
                                <Image Source="{Binding ImagePreview}"
                                       Stretch="Uniform"
                                       VerticalAlignment="Center"
                                       HorizontalAlignment="Center"/>
                            </Border>

                            <!-- Header -->
                            <StackPanel Grid.Row="0" Grid.Column="1" Orientation="Vertical">
                                <TextBlock Text="{Binding Name}"
                                           FontSize="16"
                                           FontWeight="SemiBold"
                                           TextTrimming="CharacterEllipsis"
                                           Margin="0,0,0,2"/>
                                <TextBlock Text="{Binding InventoryNumber}"
                                           FontSize="12"
                                           Foreground="#666666"/>
                            </StackPanel>

                            <!-- Equipment info rows -->
                            <StackPanel Grid.Row="1" Grid.Column="1" Orientation="Horizontal" Margin="0,6,0,0">
                                <Canvas Width="20" Height="20">
                                    <Path Data="M4,2H20A2,2 0 0,1 22,4V16A2,2 0 0,1 20,18H16L12,22L8,18H4A2,2 0 0,1 2,16V4A2,2 0 0,1 4,2Z"
                                          Fill="#666666" Stretch="Uniform"/>
                                </Canvas>
                                <TextBlock Text="{Binding EquipmentType.Name}"
                                           Margin="8,0,0,0"
                                           FontSize="13"
                                           VerticalAlignment="Center"/>
                            </StackPanel>

                            <StackPanel Grid.Row="2" Grid.Column="1" Orientation="Horizontal" Margin="2,4,0,0">
                                <Canvas Width="20" Height="20">
                                    <Path Data="M12,11.5A2.5,2.5 0 0,1 9.5,9A2.5,2.5 0 0,1 12,6.5A2.5,2.5 0 0,1 14.5,9A2.5,2.5 0 0,1 12,11.5M12,2A7,7 0 0,0 5,9C5,14.25 12,22 12,22C12,22 19,14.25 19,9A7,7 0 0,0 12,2Z"
                                          Fill="#666666" Stretch="Uniform"/>
                                </Canvas>
                                <TextBlock Text="{Binding Room.Name}"
                                           Margin="8,0,0,0"
                                           FontSize="13"
                                           VerticalAlignment="Center"/>
                            </StackPanel>

                            <StackPanel Grid.Row="3" Grid.Column="1" Orientation="Horizontal" Margin="2,4,0,8">
                                <Canvas Width="20" Height="20">
                                    <Path Data="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z"
                                          Fill="#666666" Stretch="Uniform"/>
                                </Canvas>
                                <TextBlock Text="{Binding ResponsibleUser.FullName}"
                                           Margin="8,0,0,0"
                                           FontSize="13"
                                           VerticalAlignment="Center"
                                           TextTrimming="CharacterEllipsis"/>
                            </StackPanel>

                            <!-- Status -->
                            <Border Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="2"
                                    CornerRadius="4"
                                    Background="{Binding StatusColor}"
                                    VerticalAlignment="Bottom"
                                    HorizontalAlignment="Stretch"
                                    Margin="0,8,0,0"
                                    Padding="8,4"
                                    Height="28">
                                <TextBlock Text="{Binding Status.Name}"
                                           Foreground="White"
                                           FontSize="12"
                                           FontWeight="Medium"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"/>
                            </Border>

                            <!-- Action buttons -->
                            <StackPanel Grid.Row="5" Grid.Column="0" Grid.ColumnSpan="2"
                                        Orientation="Horizontal"
                                        HorizontalAlignment="Right"
                                        Margin="0,8,0,0">
                                <Button Command="{Binding DataContext.EditCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                        CommandParameter="{Binding}"
                                        ToolTip="Редактировать"
                                        Width="32" Height="32"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        Cursor="Hand">
                                    <Viewbox Width="18" Height="18">
                                        <Path Data="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"
                                              Fill="#0060AC"/>
                                    </Viewbox>
                                </Button>

                                <Button Command="{Binding DataContext.DeleteCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                        CommandParameter="{Binding}"
                                        ToolTip="Удалить"
                                        Width="32" Height="32"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        Margin="4,0,0,0"
                                        Cursor="Hand">
                                    <Viewbox Width="18" Height="18">
                                        <Path Data="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,0 0 0,0 8,21H16A2,0 0 0,0 18,19V7H6V19Z"
                                              Fill="#E41613"/>
                                    </Viewbox>
                                </Button>
                            </StackPanel>
                        </Grid>
                    </Border>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>
    </Grid>
</UserControl>
